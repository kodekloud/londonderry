<div class="contest-container">
    <div class="row">
        <div class="col-xs-12">
            <div id="contest_image">
                <script id="contest_template" type="x-tmpl-mustache">
                    <img alt="..." src="{{photo_url_abs}}">
                </script>
            </div>
            <form accept-charset="UTF-8" action="/contest_entries" onsubmit="return validateForm()" enctype="multipart/form-data" id="contest_form" method="post">
            
                <label for="propert_id" style="display:none">Property ID</label>
                <input id="propert_id" name="contest[property_id]" style="display:none" value="{{site.property.id}}" />
                <label for="contest_id" style="display:none">Contest ID</label>
                <input id="contest_id" name="contest[contest_id]" style="display:none" value="{{contest.id}}" />
                <div class="row-fluid">
                    <div class="span6">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" class="form_entry" name="contest[first_name]" value="{{ session_data['first_name'] }}" />
                    </div>
                    <div class="span6">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" class="form_entry" name="contest[last_name]" value="{{ session_data['last_name'] }}"/>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span6">
                        <label for="email">Email</label>
                        <input type="text" id="email" class="form_entry" name="contest[email]" value="{{ session_data['email'] }}"/>
                    </div>
                    <div class="span6">
                        <label for="phone">Phone Number</label>
                        <input type="text" id="phone" class="form_entry" name="contest[phone]" value="{{ session_data['phone'] }}"/>
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span3">
                        <label for="postal_code">Postal Code</label>
                        <input type="text" id="postal_code" name="contest[postal_code]" value="{{ session_data['postal_code'] }}"/>
                    </div>
                    <div class="span3">
                        <label for="age">Age</label>
                        <input type="text" id="age" name="contest[age]"  value="{{ session_data['age'] }}"/>
                    </div>
                       
                    <div class="span6">
                        <label for="gender">Gender</label>
                        <select id="gender" name="contest[gender]">
                            <option value="">Choose</option>
                            {% if session_data['gender'] == 'female' %}
                                <option value="female" selected>Female</option>
                            {% else %}
                                <option value="female">Female</option>
                            {% endif %}
                            {% if session_data['gender'] == 'male' %}
                                <option value="male" selected>Male</option>
                            {% else %}
                                <option value="male">Male</option>
                            {% endif %}
                        </select>
                    </div>                
                </div>
                <div class="">          
                    <label for="mall_info" style="display:none">Subscribe to STC Newsletter</label>
                    <input class="info_check" id="mall_info" type="checkbox" name="contest[newsletter]" />
                    <span>Subscribe to STC Newsletter</span>
                </div> 
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        function renderPageData(){
            var repoList = getRepoList();
            renderContest("#contest_template", "#contest_image", repoList);
        }
        loadMallData(renderPageData);

        $('#loading').hide();
        $('#page_content').fadeIn('fast');
    });
    
    function renderContest(contest_template, contest_image, repo){
    
        var item_list = [];
        var item_rendered = [];
        var contest_template_html = $(contest_template).html();
        Mustache.parse(contest_template_html);   // optional, speeds up future uses
    
        
        $.each( repo , function( key, val ) {
            if( val.name == "contest"){
                $.each( val.images, function( key, image ) { 
                    var repo_rendered = Mustache.render(contest_template_html,image);
                    item_rendered.push(repo_rendered);
                });
            }
        });
       
       
        // $.each( item_list , function( key, val ) {
        //   console.log(val);
        //     var repo_rendered = Mustache.render(contest_template_html,val);
        //     item_rendered.push(repo_rendered);
        // });
      
       
        $(contest_image).show();
        $(contest_image).html(item_rendered.join(''));
    }
</script>