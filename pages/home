<style>
    .page_content{
        padding-top:0px;
    }
    .navbar{
        margin-bottom:0px;
    }
    
</style>
<div class="home">
        <div data-ride="carousel" class="carousel slide" id="carousel-example-generic">
          <!-- Indicators -->
            <ol class="carousel-indicators" id="banner_indicator" style="{{show_style}}">
                <script id="indicator_template" type="x-tmpl-mustache">
                    <li data-slide-to="{{slide_number}}" data-target="#carousel-example-generic" class="{{active_carousel}}"></li>                        
                </script>
            </ol>
            
              <!-- Wrapper for slides -->
            <div class="carousel-inner" id="home_banner">
            
                <script id="banner_template" type="x-tmpl-mustache">
               <div class="item">
                        <a href="{{url}}" {{css}} onclick="{{noLink}}">
                      <img alt="..." src="{{photo_url_abs}}">
                      </a>
                </div>
            
                </script>
            </div>
            
            <div id="controls">
              <!-- Controls -->
              <a data-slide="prev" role="button" href="#carousel-example-generic" class="left carousel-control">
                <span class="glyphicon glyphicon-chevron-left"></span>
              </a>
              <a data-slide="next" role="button" href="#carousel-example-generic" class="right carousel-control">
                <span class="glyphicon glyphicon-chevron-right"></span>
              </a>
              </div>
        </div>


    <div class="container">
        <div class="row feature-items">
            <div class="col-sm-12 col-sm-6 col-md-3 feature-item">
               <div data-i18n="general.todays_hours" class="header feature-bottom-border"></div>
               <div id="todays-hours">
                   <script id="todays_hours_template" type="x-tmpl-mustache">
                        <h5 data-i18n="days_of_week.{{day_of_week}}"></h5>
                        <div>{{holiday_name}}</div>
                        <span class="today_hour" style="{{is_open_css}};">
                            {{open_time_localized}} - {{close_time_localized}}
                        </span>
                        <span style="{{is_closed_css}};">
                            Closed
                        </span>
                    </script>
                </div>
                <div id="hours_not_empty_section_id">
                    <!-- START MUSTACHE TEMPLATE FOR HOLIDAY HOURS ITEM-->
                    <script id="holiday_hours_template" type="x-tmpl-mustache">
                        
                        <li class="">
                            <span class="">{{holiday_name}}</span>
                            <div style="{{is_open_css}};">
                                {{open_time_localized}} - {{close_time_localized}}
                            </div>
                            <div style="{{is_closed_css}};">
                                Closed
                            </div>
                        </li>
                        
                    </script>
                    <ul class="holiday-hours" id="holiday-hours">
                        <!--this content to be rendered by renderHolidayHours(..) -->
                    </ul>
                </div>
                <div id="hours_empty_section_id"></div>
                <a href="../contact_us#opening_hours" class="btn btn-default"  data-i18n="general.click_more_button"></a>
            </div>
            <div class="col-sm-12 col-sm-6 col-md-3 feature-item">
               <div class="header" data-i18n="general.directions"></div>
               <a href="../contact_us#directions"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2367.495438102178!2d-113.444905!3d53.602464!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNTPCsDM2JzA4LjkiTiAxMTPCsDI2JzQxLjciVw!5e0!3m2!1sen!2sca!4v1418252877292" width="263" height="170" frameborder="0" style="border:0"></iframe></a>
            </div>
            <div class="col-sm-12 col-sm-6 col-md-3 feature-item">
                <div class="header" data-i18n="general.gift_card"></div>
                <a href="../customer_services#gift_cards"><img src="http://kodekloud.s3.amazonaws.com/sites/54612c496e6f6474ba020000/e876a3b54a208d3611bff73000a50e23/londonderry_card.png" class="" alt="" style="width:100%"></a>
            </div>
            <div class="col-sm-12 col-sm-6 col-md-3 feature-item ">
               <div data-i18n="general.be_the_first_to_know" class="header feature-bottom-border"></div>
               <span data-i18n="general.join_txt" style="font-size:18px"></span>
               <div class="newsletter-sign-up" style="margin-top:15px">
                    <form action="http://mobilefringe.createsend.com/t/d/s/ykbo/" method="post" id="subForm">
                       <label for="subscribe_email" style="display:none"> subscribe email </label>
                            <input id="fieldEmail" name="cm-name" type="email" required placeholder="enter email" /> 
                       <div class="checkbox">
                        <span>
                          <input type="checkbox" class="info_check" id="agree_terms" style="width:15px"/>&nbsp;I agree to receive emails from Londonderry
                        </span>
                      </div>
                        <button class="btn btn-default feature-item-button"  data-i18n="general.submit"></button>
                       <br />
                       <span id="success_subscribe" style="font-size:20px;padding:10px">Thank You!</span>
                   </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        function renderPageData(){
            //console.log('rendering page data');
            renderHolidayHours('#holiday_hours_template','#holiday-hours','#hours_not_empty_section_id','#hours_empty_section_id',getPropertyHours(),2);
            renderTodaysHours('#todays_hours_template','#todays-hours');
            $('#loading').hide();
            $('#page_content').fadeIn('fast');
            
            
                 var repoList = getRepoList();
                 renderIndicator('#indicator_template','#banner_indicator', repoList);
                renderBanner('#banner_template','#home_banner',repoList);
        }
        loadMallData(renderPageData);
        
        
        $('#subForm').submit(function (e) {
           if ($("#agree_terms").prop("checked") != true){
               alert("Please agree to the term and conditions.");
               $("#agree_terms").focus();
               return false;
           }
           e.preventDefault();
           $.getJSON(
               this.action + "?callback=?",
               $(this).serialize(),
               function (data) {
                   if (data.Status === 400) {
                       alert("Please try again later.");
                   } else { // 200
                       $("#success_subscribe").fadeIn();
                   }
           });
       });
    });
    
    
function renderBanner(banner_template, home_banner, repo){
    
    var item_list = [];
    var item_rendered = [];
    var banner_template_html = $(banner_template).html();
    Mustache.parse(banner_template_html);   // optional, speeds up future uses

    $.each( repo , function( key, val ) {
        if( val.name == "banner"){
            $.each( val.images , function( key, val ) {
               if(val.url == ""){
                   val.css = "style=cursor:default;";
                   val.noLink = "return false";
               }
                item_list.push(val);
               
            });
        }
    });
    item_list.sort(function(a, b){
        if(a.name < b.name) return -1;
        if(a.name > b.name) return 1;
        return 0;
    });
    $.each( item_list , function( key, val ) {
            var repo_rendered = Mustache.render(banner_template_html,val);
            item_rendered.push(repo_rendered);
           
    });
    
   
    $(home_banner).show();
    $(home_banner).html(item_rendered.join(''));
    $('.item').first().addClass('active');
}
    
function renderIndicator(indicator_template, home_indicator, repo){
    
    var item_list = [];
    var item_rendered = [];
    var banner_template_html = $(indicator_template).html();
    Mustache.parse(banner_template_html);   // optional, speeds up future uses
    var bannerCount = 0;
    
    $.each( repo , function( key, val ) {
        if( val.name == "banner"){
            $.each( val.images , function( key, val ) {
                item_list.push(val);
            });
        }
    });
    item_list.sort(function(a, b){
        if(a.name < b.name) return -1;
        if(a.name > b.name) return 1;
        return 0;
    });
    $.each( item_list , function( key, val ) {
      
           
        if (bannerCount == 0){
            val.active_carousel = "active";
        }
        val.slide_number = bannerCount;
        
        var repo_rendered = Mustache.render(banner_template_html,val);
        item_rendered.push(repo_rendered);
         bannerCount ++;
    });
    
    if(item_list.length <= 1){
        $(home_indicator).hide();
        $('#controls').hide();
    } else {
         $(home_indicator).show();
    }
    $(home_indicator).html(item_rendered.join(''));
}
</script>